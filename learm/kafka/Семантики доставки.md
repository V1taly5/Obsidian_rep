В любых очередях есть выбор между скоростью доставки и расходами на надёжность. Цветные квадратики на картинке — это сообщения, которые мы будем записывать в очередь, выбирая нужную из семантик.
![[Pasted image 20240310150831.png]]
- Семантика **_at-most once_** означает, что при доставке сообщений нас устраивают потери сообщений, но не их дубликаты. Это самая слабая гарантия, которую реализуют брокерами очередей  
- Семантика **_at-least once_** означает, что мы не хотим терять сообщения, но нас устраивают возможные дубликаты
- Семантика **_exactly-once_** означает, что мы хотим доставить одно и только одно сообщение, ничего не теряя и ничего не дублируя.
На первый взгляд самой правильной для любого приложения кажется семантика exactly once, однако это не всегда так. Например, при передаче партнёрских координат вовсе не обязательно сохранять каждую точку из них, и вполне хватит at-most once. А при обработке идемпотентных событий нас вполне может и устроить дубль, если статусная модель предполагает его корректную обработку.
В распределённых системах у exactly-once есть своя цена: высокая надёжность означает большие задержки. Рассмотрим, какие инструменты предлагает Kafka для реализации всех трёх семантик доставки сообщений в брокер.
