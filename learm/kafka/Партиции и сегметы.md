Ограничений на количество топиков в кластере Kafka нет, но есть ограничения самого компьютера, он выполняет операции на процессоре, вводе-выводе, и в итоге упирается в свой предел. Мы не можем увеличить мощность и производительность машин бесконечно, а потому топик следует делить на части.![[Pasted image 20240309110706.png]]

В Kafka эти части называются **_партициями_**. Каждый топик состоит из одной или более партиций, каждая из которых может быть размещена на разных брокерах. За счет этого кафка может масштабироваться: пользователь может создать топик, разделить его на партиции и разместить каждую из них на отдельном брокере. 
Формально говоря партиция и есть строго упорядоченный лог сообщений. Каждое сообщение в ней добавлено в конец без возможности изменить его в будущем и как-то повлиять на уже записанные сообщения. При этом сам топик в целом не имеет никакого порядка, но порядок сообщений всегда есть в одной из его партиций.
Сами партиции физически представлены на диске в виде сегментов. Это отдельные файлы, которые можно создать, редактировать и удалить в соответствии с настройками устаревания данных в них. Обычно нам не приходится часто вспоминать о сегментах партиций, если вы не администрируете калстер, но важно помнить саму модель хранения данных в топиках kafka.
Разберем детали на примере. В кластере Kafka есть три брокера: 101, 102 и 103. Топик А отмечен бирюзовым, топик B - желтым, С - оранжевым. На картинке у каждого топика по три партиции, но их число может быть разным и настраивается для каждого топика.
![[Pasted image 20240309113734.png]]
Партиции распределены между брокерами - кластер Kafka делает это автоматически при создании топика. Инструмент автоматически не следит за размером каждой партиции, не занимается ребалансировкой записи и чтения в кластере, не перемещает партиции между брокерами. Для этого уже существуют opensource-инструменты и готовые enterprise-платформы.
Каждая партиция на брокере представлена набором сегментов. Число сегментов у партиций тоже может быть разным. Оно варьируется в зависимости от интенсивности записи и настроек размера сегмента. 
В итоге, мы можем увеличить число брокеров в кластере и тем самым масштабировать систему. Kafka поддерживает добавление и удаление брокеров. А с помощью внутренних инструкций можно, например, переносить партиции между брокерами чтобы равномерно их распределять. 
Можно также добавлять новые партиции в топике - это увеличивает параллелизм записи и чтения со стороны продюсера и консумера. 
Наконец можно изменять настройки сегментов, чтобы управлять частотой и интенсивностью ротаций отдельных файлов на дисках брокеров. Рассмотрим устройство [[Сегмент|сегмента]] подробнее.